# CSV - API

    1. Основная информация
    HTTP сервис, предназначенный для работы с импортируемыми данными в формате csv различного формата.
    
    Реализованы возможности получения списка файлов с информацией о колонках, данных 
    по конкретному файлу с опциолнальными фильтрацией и сортировкой по столбцам. 
    Реализована авторизация пользователя, эндпоинт для удаления ранее загруженного файла, 
    система кеширования на базе Redis, есть Dockerfile для запуска в Docker.

    2. Запрос/Ответ

    2.1 Запрос и ответ на загрузку csv файла

<center>

| Запрос                                                                                                                                                                                                               | Ответ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|                                                             
| curl -X 'POST' \ <br/> 'http://127.0.0.1:8000/files/upload?name=example' \ <br/> -H 'accept: application/json' \ <br/> -H 'Content-Type: multipart/form-data' \ <br/> -F 'file=@dailySteps_merged.csv;type=text/csv' | Response code: 200 <br/> Response body:<br/>{<br/>&nbsp;&nbsp;&nbsp;"status": "success"<br/>} |

</center>

    2.2 Запрос и ответ на получение списка файлов с информацией о колонках

<center>

| Запрос                                                                                    | Ответ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|                                                             
| curl -X 'GET' \ 'http://127.0.0.1:8000/files/review' \ <br/>-H 'accept: application/json' | Response code: 200<br/>Response body:<br/>{<br/>&nbsp;&nbsp;&nbsp;"status": "success", <br/>&nbsp;&nbsp;&nbsp;"data": [<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"test": [<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"id",<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"value",<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"logid",<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"date"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br/>&nbsp;&nbsp;&nbsp;&nbsp;],<br/>&nbsp;&nbsp;&nbsp;"details": null<br/>} |

</center>

    2.3 Запрос и ответ на получение конкретного файла

<center>

| Запрос                                                                                                                                                               | Ответ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|                                                             
| curl -X 'GET' \ 'http://127.0.0.1:8000/files/get_csv_files/test? <br/> limit=50&offset=0&filter=logid%20%3E%202&order_by=value' \ <br/> -H accept: application/json' | Response code: 200<br/>Response body:<br/>{<br/>&nbsp;&nbsp;&nbsp;"status": "success", <br/>&nbsp;&nbsp;&nbsp;"data": {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"test": [<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3977333714,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"4/15/2016 10:02:00 AM",<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11468101354<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br/>&nbsp;&nbsp;&nbsp;&nbsp;},<br/>&nbsp;&nbsp;&nbsp;"details": null<br/>} |

</center>

    2.4 Запрос и ответ на удаление csv файла

<center>

| Запрос                                                                                               | Ответ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|                                                             
| curl -X 'DELETE' \ <br/> 'http://127.0.0.1:8000/files/example' \ <br/> -H 'accept: application/json' | Response code: 200 <br/> Response body:<br/>{<br/>&nbsp;&nbsp;&nbsp;"status": "success"<br/>} |

</center>

    3. О проекте
    Сервис написан на FastAPI с базой данных PostgreSQL, для кеширования запросов использовался Redis.
    Авторизация пользователей написана на базе библиотеки FastAPI Users (Cookie, JWT),
    в дальнейшем планируется переписать её на OAuth2.

    В проекте получилось создать рабочую, но спорную реализацию хранения файлов csv 
    путём динамического формирования соответствующих таблиц в БД с их наполнением.
    К примеру, так как эндпоинты реализованы через raw-запросы к БД, не получилось найти
    рабочего решения, как подключить к проекту Celery и пришлось ограничиться BackgroundTasks.

    В целом же API выполняет возложенный на неё функционал.